import os
import array
from matplotlib import pyplot as plt
import numpy as np
import imageio


def convert_malware_to_image(malware_file):
    width = 256
    with open(malware_file, 'rb') as f:
        data = f.read()
    a = array.array("B", data)
    rem = len(a) % width
    a = a[:len(a) - rem]
    g = np.reshape(a, (len(a) // width, width))
    g = np.uint8(g)
    output_file = os.path.splitext(os.path.basename(malware_file))[0] + '.png'
    imageio.imwrite(output_file, g)
    return g


# Sử dụng hàm với tên tệp malware
malware_file = 'Downloads/wildfire-test-pe-file.exe'
malware_image = convert_malware_to_image(malware_file)

plt.imshow(malware_image, cmap='gray')
plt.axis('off')  # Ẩn trục
plt.show()
